@model SalesAndInentoryWeb_Application.tbl_PurchaseOrder
@{
    ViewBag.Title = "Sale Order";
    Layout = "~/Views/Shared/ideal.cshtml";
}
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    @Html.DevExpress().GetStyleSheets(
        new StyleSheet { ExtensionSuite = ExtensionSuite.NavigationAndLayout },
        new StyleSheet { ExtensionSuite = ExtensionSuite.Editors }
    )
    @Html.DevExpress().GetScripts(
        new Script { ExtensionSuite = ExtensionSuite.NavigationAndLayout },
        new Script { ExtensionSuite = ExtensionSuite.Editors }
    )
    <style>
        .scrolldown {
            overflow-y: scroll;
            height: 100px;
        }

        textarea.form-control {
            height: 40px;
            margin: 0px;
            resize: vertical;
        }
    </style>
    <script src="~/scripts/jquery-1.12.4.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#btnaddtolist").click(function () {
                AddToItem();
            });
            $("#btnsubmit").click(function (e) {
                additems();
            });
            $("#ID").change(function () {
                debugger
                var fruitId = $(this).find("option:selected").val();
                if (fruitId != "") {
                    $.ajax
                   ({
                       type: "POST",
                       url: "/ParchaseOrder/GetFruitName1",
                       data: "id=" + fruitId,
                       success: function (data) {
                           var content = "";
                           for (var x in data) {
                               $("#sp").val(data[x].SalePrice);
                               $("#ts").val(data[x].TaxForSale);
                               $("#sa").val(data[x].SaleTaxAmount);
                           }
                       }
                   });
                }
            });
            $("#PartiesID").change(function () {
                debugger
                var fruitId = $(this).find("option:selected").val();
                if (fruitId != "") {
                    $.ajax
                   ({
                       type: "POST",
                       url: "/ParchaseOrder/GetFruitName",
                       data: "id=" + fruitId,
                       success: function (data) {
                           var content = "";
                           for (var x in data) {
                               $("#BillingName").val(data[x].BillingAddress);
                               $("#ContactNo").val(data[x].ContactNo);
                           }

                       }
                   });
                }
            });

            $("#sp").change(function () {
                debugger
                var mrp = $("#sp").val();
                var tax = $("#ts").val();
                var dis = $("#ds").val();
                var qty = $("#qty").val();
                var itempricecall = mrp * 1;
                var tax_cal = itempricecall * tax / 100;
                var dis_count = itempricecall * dis / 100;
                var finalcal = (itempricecall + tax_cal) - dis_count

                $("#da").val(dis_count);
                $("#sa").val(tax_cal);
                $("#ca").val(finalcal);
                $("#Qty").val(1);

            });
            $("#ts").change(function () {

                debugger
                var mrp = $("#sp").val();
                var tax = $("#ts").val();
                var dis = $("#ds").val();
                var qty = $("#qty").val();
                var itempricecall = mrp * qty;
                var tax_cal = itempricecall * tax / 100;
                var dis_count = itempricecall * dis / 100;
                var finalcal = (itempricecall + tax_cal) - dis_count

                $("#da").val(dis_count);
                $("#sa").val(tax_cal);
                $("#ca").val(finalcal);
                $("#qty").val(1);

            });

            $("#ds").change(function () {


                debugger
                var mrp = $("#sp").val();
                var tax = $("#ts").val();
                var dis = $("#ds").val();
                var qty = $("#qty").val();
                var itempricecall = mrp * qty;
                var tax_cal = itempricecall * tax / 100;
                var dis_count = itempricecall * dis / 100;
                var finalcal = (itempricecall + tax_cal) - dis_count

                $("#da").val(dis_count);
                $("#sa").val(tax_cal);
                $("#ca").val(finalcal);
                $("#qty").val(1);

            });
            $("#recived").change(function () {

                var recived = $("#recived").val();
                var pretotal = $("#Total").val();
                var tototo = pretotal - recived;
                $("#RemainingBal").val(tototo);

            });
            $("#qty").change(function () {

                var mrp = $("#sp").val();
                var tax = $("#ts").val();
                var dis = $("#ds").val();
                var qty = $("#qty").val();
                var itempricecall = mrp * qty;
                var tax_cal = itempricecall * tax / 100;
                var dis_count = itempricecall * dis / 100;
                var finalcal = (itempricecall + tax_cal) - dis_count

                $("#da").val(dis_count);
                $("#sa").val(tax_cal);
                $("#ca").val(finalcal);
                $("#qty").val(1);

            });

        });
        function RemoveItem(ItemName)
        {
            $(ItemName).closest('tr').remove();
        }
        function minus() {
            var pretotal1 = $("#Total").val();
            var pretotal2 = $("#Balance").val();
            var find = pretotal1 - pretotal2
            $("#Paid").val(find);
        };

      
        function AddToItem()
        {
            var tableitemlist = $("#tblSaleInvoice");
            var ItemName=$("#ID option:selected").val();
            var mrp = $("#sp").val();
            var tax = $("#ts").val();
            var dis = $("#ds").val();
            var qty = $("#qty").val();
            var disamt = $("#da").val();
            var taxmat = $("#sa").val();
            var total = $("#ca").val();

            var itemlist = "<tr><div class='scrollit' ><td>" + ItemName + "</td><td>" + mrp + "</td><td>" + tax + "</td><td>" + dis + "</td><td>"
            + qty + "</td><td>" + disamt + "</td><td>" + taxmat + "</td><td>" + total + "</td><td> <input type='button' value='Remove' name='remove' class='btn btn-danger' onclick='RemoveItem(this)'/></td></tr>"
            tableitemlist.append(itemlist);
            reset();
            var finding = 0;
            $("tr").each(function (indexTr) {

                var mm = +$(this).find('td:eq(7)').text();
                finding = finding + mm;

                $("#Total").val(finding);
            })
            
            var fixfinding = 0;

            $("tr").each(function (indexTr) {

                var mm = +$(this).find('td:eq(6)').text();
                fixfinding = fixfinding + mm;
                $("#TaxAmount1").val(fixfinding);

            })
        }
        function reset()
        {
            $("#ID option:selected").val('');
            $("#sp").val('');
            $("#ts").val('');
            $("#ds").val('');
            $("#qty").val('');
            $("#da").val('');
            $("#sa").val('');
            $("#ca").val('');
        }
        function additems() {
            debugger
            var objpurchaseorder = {};
            var listofpurchaseorder = [];

            $.each($("#tblSaleInvoice tbody tr"),
                function () {
                    listofpurchaseorder.push({
                        ItemName: $(this).find("td:eq(0)").text(),
                        SalePrice: $(this).find("td:eq(1)").text(),
                        TaxForSale: $(this).find("td:eq(2)").text(),
                        Discount: $(this).find("td:eq(3)").text(),
                        Qty: $(this).find("td:eq(4)").text(),
                        DiscountAmount: $(this).find("td:eq(5)").text(),
                        SaleTaxAmount: $(this).find("td:eq(6)").text(),
                        ItemAmount: $(this).find("td:eq(7)").text()
                    });
                });

            objpurchaseorder.PartyName = $("#PartiesID option:selected").val();
            objpurchaseorder.BillingName = $("#BillingName").val();
            objpurchaseorder.ContactNo = $("#ContactNo").val();
            objpurchaseorder.OrderDate = $("#OrderDate").val();
            objpurchaseorder.DueDate = $("#DueDate").val();
            objpurchaseorder.Barcode = $("#Barcode").val(); 
            objpurchaseorder.TaxAmount1 = $("#TaxAmount1").val();
            objpurchaseorder.StateOfSupply = $("#StateOfSupply option:selected").val();
            objpurchaseorder.Paid = $("#Paid").val();
            objpurchaseorder.RemainingBal = $("#RemainingBal").val();
            objpurchaseorder.TransportName = $("#TransportName").val();

            objpurchaseorder.DeliveryLocation = $("#DeliveryLocation").val();
            objpurchaseorder.DeliverDate = $("#DeliveryDate").val();
            objpurchaseorder.PaymentType = $("#PaymentType").val();
            objpurchaseorder.TransportName = $("#TransportName").val();
            objpurchaseorder.Status = $("#Status option:selected").val();
            objpurchaseorder.VehicleNumber = $("#VehicleNumber").val();
            objpurchaseorder.Total = $("#Total").val();
            objpurchaseorder.ListOfPurchaseOrder = listofpurchaseorder;


            $.ajax({
                async: true,
                type: "POST",
                datatype: 'JSON',
                contentType: 'application/json;charset=utf-8',
                data: JSON.stringify(objpurchaseorder   ),
                url: '/ParchaseOrder/AddOrder',
                success: function (data) {
                    if (data.status == true) {
                        alter(data.message);
                    }
                },
                error: function () {
                    alert("error");
                }

            });
        }
    </script>
</head>
<body>
    @using (Html.BeginForm())
    {
        <div class="panel panel-primary container" style="height:100%; width:100%;">
            <div class="panel-heading"><a class="btn" href=@Url.Action("PurchaseOrder", "ParchaseOrder") style="background-color:#05445E;color:white">Back To List</a><p style="margin-left:486px;margin-top: -31px;font-weight:bold;font-size:20px;">Purchasr Order</p></div>
            <div class="panel border-box">

                <div class="container-fluid">
                    <div class="collapse navbar-collapse ">
                       
                        <div class="row">
							<div class="form-group col-md-3">						
								Party Name:
                                @Html.DropDownListFor(model => model.PartiesID, Model.ListOfParties, "Select Item",new { @class = "form-control", @style = "width:220px" } )
								Address:
								@Html.TextAreaFor(model => model.BillingName,new { @class = "form-control", placeholder = "Address", @style = "width:220px;height:50px" } )
								Contact No:
								@Html.EditorFor(model => model.ContactNo, new { htmlAttributes = new { @class = "form-control", placeholder = "Mobile No.....", @style = "width:220px;height:32px" } })
								@Html.ValidationMessageFor(model => model.ContactNo)
							</div>
                            <div class="form-group col-md-7">
								<div class="pull-right">


									Order Date:
									@Html.TextBoxFor(model => model.OrderDate, new { @type = "date", @class = "form-control", @style = "width:150px;" })
									Barcode:
									@Html.EditorFor(model => model.Barcode, new { htmlAttributes = new { @class = "form-control", placeholder = "BarcodNo", @style = "width:150px;height:30px" } })
									@Html.ValidationMessageFor(model => model.Barcode)
                                
                                    @Html.EditorFor(model => model.TaxAmount1, new { htmlAttributes = new { @class = "form-control",id= "TaxAmount1", placeholder = "BarcodNo", @style = "width:150px;height:30px; Display:None;" } })
                                    @Html.ValidationMessageFor(model => model.TaxAmount1)


								</div>







                            </div>


                            <div class="form-group col-md-2">

								<div class="pull-right">
									E-Way BillNo:
									@Html.EditorFor(model => model.Feild4, new { htmlAttributes = new { @class = "form-control", placeholder = "Eway Bill Number", @style = "width:150px;height:30px" } })
									@Html.ValidationMessageFor(model => model.Feild4)
									State :
									<select name="state" id="StateOfSupply" class="form-control" style="width:150px;height:30px">
										<option value="Andhra Pradesh">Andhra Pradesh</option>
										<option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
										<option value="Arunachal Pradesh">Arunachal Pradesh</option>
										<option value="Assam">Assam</option>
										<option value="Bihar">Bihar</option>
										<option value="Chandigarh">Chandigarh</option>
										<option value="Chhattisgarh">Chhattisgarh</option>
										<option value="Dadar and Nagar Haveli">Dadar and Nagar Haveli</option>
										<option value="Daman and Diu">Daman and Diu</option>
										<option value="Delhi">Delhi</option>
										<option value="Lakshadweep">Lakshadweep</option>
										<option value="Puducherry">Puducherry</option>
										<option value="Goa">Goa</option>
										<option value="Gujarat">Gujarat</option>
										<option value="Haryana">Haryana</option>
										<option value="Himachal Pradesh">Himachal Pradesh</option>
										<option value="Jammu and Kashmir">Jammu and Kashmir</option>
										<option value="Jharkhand">Jharkhand</option>
										<option value="Karnataka">Karnataka</option>
										<option value="Kerala">Kerala</option>
										<option value="Madhya Pradesh">Madhya Pradesh</option>
										<option value="Maharashtra">Maharashtra</option>
										<option value="Manipur">Manipur</option>
										<option value="Meghalaya">Meghalaya</option>
										<option value="Mizoram">Mizoram</option>
										<option value="Nagaland">Nagaland</option>
										<option value="Odisha">Odisha</option>
										<option value="Punjab">Punjab</option>
										<option value="Rajasthan">Rajasthan</option>
										<option value="Sikkim">Sikkim</option>
										<option value="Tamil Nadu">Tamil Nadu</option>
										<option value="Telangana">Telangana</option>
										<option value="Tripura">Tripura</option>
										<option value="Uttar Pradesh">Uttar Pradesh</option>
										<option value="Uttarakhand">Uttarakhand</option>
										<option value="West Bengal">West Bengal</option>
									</select>
									Due Date:
									@Html.TextBoxFor(model => model.DueDate, new { @type = "date", @class = "form-control", @style = "width:150px;" })
								</div>
                            </div>
                        </div>


                    </div>
                </div>

                <br />

                <nav class="navbar navbar-default " style="border:none; background-color:white">
                    <div class="container-fluid">
                        <div class="collapse navbar-collapse ">
                            <div class="form-group scrolldown" style="height:200px;">

                                <table class="table table-striped table-bordered" style="width:100%;" id="tblSaleInvoice">

                                    <thead>

                                        <tr>

                                            <th>
                                                <label>Item Name</label>
                                                @Html.DropDownListFor(model => model.ID, Model.ListOfAccounts, "Select Item",  new { @class = "form-control", @style = "width:150px" } )

                                            </th>
                                            <th>
                                                <label>MRP</label>

                                                <input type="text" id="sp" name="" class="form-control" style="width:80PX">
                                            </th>
                                            <th>
                                                <label>Tax%</label>
                                                <input type="text" id="ts" name="" class="form-control" style="width:80PX">
                                            </th>
                               <th>
                                                <label>Discount</label>
                                                <input type="text" id="ds" name="" class="form-control" style="width:80PX">

                                            <th>
                                                <label>Qty</label>
                                                <input type="text" id="qty" name="" class="form-control" style="width:80PX">
                                            </th>
                                            <th>
                                                <label>Dis Amount</label>
                                                <input type="text" id="da" name="" class="form-control" style="width:80PX">

                                            </th>
                                            <th>
                                                <label>Tax Amount</label>
                                                <input type="text" id="sa" name="" class="form-control" style="width:80PX">
                                            </th>
                                            <th>
                                                <label>Total</label>
                                                <input type="text" id="ca" name="" class="form-control" style="width:80PX">
                                            </th>
                                            <th>
                                                <a class="btn btn-primary pull-right" style="margin-top:20px;" id="btnaddtolist"><i class="fa fa-plus"></i>Add Item</a>
                                            </th>

                                        </tr>
                                    </thead>

                                </table>
                            </div>
                        </div>
                    </div>
                </nav>



                <div class="container-fluid">
                    <div class="collapse navbar-collapse ">
                        <div class="row">

                            <div class="col-md-2">
                                Payment Type:
                                <select name="cars" id="PaymentType" class="form-control" style="width:150px;">
                                    <option value="Select PaymentType">Select PaymentType</option>
                                    <option value="Cash">Cash</option>
                                    <option value="OnlinePayment">Online Payment</option>
                                    <option value="Cheque">Cheque</option>
                                </select>
                               Transport Name:
                                @Html.DevExpress().TextBoxFor(m => m.TransportName, settings =>
                                  {
                                      settings.Properties.NullText = "TransportName";
                                      settings.ControlStyle.CssClass = "form-control";
                                      settings.Style["width"] = "150px";
                                      settings.Style["height"] = "30px";
                                  }).GetHtml()
                              Vical No:
                                @Html.EditorFor(model => model.VehicleNumber, new
                           {
                               htmlAttributes = new
                               {
                                   @class = "form-control",
                                   placeholder = "Vehicle Number",
                                   @style = "width:150px;height:30px;"
                               }
                           })
                                @Html.ValidationMessageFor(model => model.VehicleNumber)





                            </div>
                            <div class="col-md-2 form-group">
                                Cheque No:
                                @Html.EditorFor(model => model.Feild1, new { htmlAttributes = new { @class = "form-control", placeholder = "Cheek no", @style = "width:150px;" } })
                                @Html.ValidationMessageFor(model => model.Feild1)

                              Delivery Date:
                                @Html.TextBoxFor(model => model.Deliverydate, new { @type = "date", @class = "form-control", @style = "width:150px;" })
                               Payment Status;
                                <select name="cars" id="Status" class="form-control" style="width:150px;">
                                    <option value="Select PaymentType">Select Payment Status</option>
                                    <option value="Paid">Paid</option>
                                    <option value="Unpiad">Unpiad</option>

                                </select>
                            </div>
                            <div class="col-md-8 form-group">

                                <div class="pull-right">
                                    Total:
                                    @Html.EditorFor(model => model.Total, new { htmlAttributes = new { @class = "form-control", placeholder = "Total Amount",id="Total" } })
                                    @Html.ValidationMessageFor(model => model.Total)
                                    Recived:
                                    @Html.EditorFor(model => model.Paid, new { htmlAttributes = new { @class = "form-control", id= "recived", placeholder = "Receive Ammount"} })
                                    @Html.ValidationMessageFor(model => model.Paid)
                                   Remining Bal:
                                    @Html.EditorFor(model => model.RemainingBal, new { htmlAttributes = new { @class = "form-control", id= "RemainingBal", placeholder = "Remaining Balance" } })
                                    @Html.ValidationMessageFor(model => model.RemainingBal)
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="row">

                        <div class="col-md-1 form-group" style="margin-top:8px; ">
                        </div>

                        <div class="col-md-3">

                        </div>
                        <div class="col-md-1 form-group" style="margin-top:8px; ">
                        </div>
                        <div class="col-md-3 form-group">
                            <input type="submit" value="Submit" class="btn btn-primary pull-left" style="margin-right:12px; width:100px;" id="btnsubmit"/>
                            <input type="reset" value="Clear" class="btn btn-primary pull-right" style="margin-right:12px; width:100px;" />

                        </div>


                        <div class="col-md-1 form-group" style="margin-top:8px; ">

                        </div>
                        <div class="col-md-3 form-group">

                        </div>

                    </div>


                </div>
            </div>
            <div>

            </div>
        </div>



    }

    <br />

    <br />

    <br />

    <br />

    <br />

    <br />

    <br />

    <br />

    <br />

    <br />

</body>
</html>
